<!-- Overlay -->
@if (isOpen) {
<div class="fixed inset-0 bg-black bg-opacity-50 z-40" (click)="close()"></div>
}

<!-- Panel lateral -->
@if (isOpen) {
<div
  class="fixed top-0 right-0 h-full w-96 bg-white dark:bg-gray-800 shadow-lg z-50 transform transition-transform duration-300 ease-in-out"
  [class.translate-x-full]="!isOpen" [class.translate-x-0]="isOpen">

  <!-- Header -->
  <div class="flex items-center justify-between p-4 border-b dark:border-gray-700">
    <h2 class="text-lg font-semibold">Detalle de Tarea</h2>
    <button (click)="close()" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>
  </div>

  <!-- Contenido -->
  <div class="flex-1 overflow-y-auto p-4">

    <!-- Detalle de la tarea -->
    <div class="mb-6">
      <h3 class="text-xl font-bold mb-2">{{ task.title }}</h3>
      @if (task.description) {
      <p class="text-gray-600 dark:text-gray-400 mb-4">{{ task.description }}</p>
      }

      <div class="grid grid-cols-2 gap-4 text-sm">
        <div>
          <span class="font-medium">Estado:</span>
          <span class="ml-2 px-2 py-1 rounded text-xs" [class.bg-red-100]="task.status === 'pending'" [class.dark:bg-red-900]="task.status === 'pending'"
            [class.bg-yellow-100]="task.status === 'in_progress'" [class.dark:bg-yellow-900]="task.status === 'in_progress'" [class.bg-green-100]="task.status === 'completed'" [class.dark:bg-green-900]="task.status === 'completed'">
            {{ task.status === 'pending' ? 'Pendiente' :
            task.status === 'in_progress' ? 'En Progreso' :
            task.status === 'completed' ? 'Completada' : task.status }}
          </span>
        </div>
        <div>
          <span class="font-medium">Prioridad:</span>
          <span class="ml-2 px-2 py-1 rounded text-xs" [class.bg-gray-100]="task.priority === 'low'" [class.dark:bg-gray-700]="task.priority === 'low'"
            [class.bg-blue-100]="task.priority === 'medium'" [class.dark:bg-blue-900]="task.priority === 'medium'" [class.bg-orange-100]="task.priority === 'high'" [class.dark:bg-orange-900]="task.priority === 'high'"
            [class.bg-red-100]="task.priority === 'urgent'" [class.dark:bg-red-900]="task.priority === 'urgent'">
            {{ task.priority === 'low' ? 'Baja' :
            task.priority === 'medium' ? 'Media' :
            task.priority === 'high' ? 'Alta' : 'Urgente' }}
          </span>
        </div>
        @if (task.due_date) {
        <div>
          <span class="font-medium">Fecha límite:</span>
          <span class="ml-2">{{ task.due_date | date:'dd/MM/yyyy' }}</span>
        </div>
        }
        @if (task.estimated_hours) {
        <div>
          <span class="font-medium">Horas estimadas:</span>
          <span class="ml-2">{{ task.estimated_hours }}</span>
        </div>
        }
      </div>
    </div>

    <!-- Comentarios -->
    <div class="border-t dark:border-gray-700 pt-4">
      <h4 class="text-lg font-semibold mb-4">Comentarios</h4>

      <!-- Lista de comentarios -->
      <div class="space-y-4 mb-4">
        @for (comment of comments(); track comment.id) {
        <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded">
          <div class="flex items-start justify-between">
            <div class="flex-1">
              <div class="flex items-center mb-2">
                <span class="font-medium text-sm">{{ comment.user?.first_name }} {{ comment.user?.last_name }}</span>
                <span class="text-xs text-gray-500 dark:text-gray-400 ml-2">{{ comment.created_at | date:'dd/MM/yyyy HH:mm' }}</span>
              </div>

              <!-- Mostrar comentario o input de edición -->
              @if (editingCommentId !== comment.id) {
              <div class="text-sm">
                {{ comment.content }}
              </div>
              }
              @if (editingCommentId === comment.id) {
              <textarea [(ngModel)]="editingContent" class="w-full p-2 border dark:border-gray-600 rounded text-sm" rows="3"></textarea>
              }
            </div>

            <!-- Acciones -->
            <div class="flex space-x-2 ml-2">
              @if (editingCommentId !== comment.id) {
              <button (click)="startEditing(comment)" class="text-blue-500 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 text-sm">
                Editar
              </button>
              }
              @if (editingCommentId === comment.id) {
              <button (click)="saveComment()" class="text-green-500 dark:text-green-400 hover:text-green-700 dark:hover:text-green-300 text-sm">
                Guardar
              </button>
              <button (click)="cancelEditing()" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 text-sm">
                Cancelar
              </button>
              }
              <button (click)="deleteComment(comment.id)" class="text-red-500 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 text-sm">
                Eliminar
              </button>
            </div>
          </div>
        </div>
        }
      </div>

      <!-- Agregar comentario -->
      <div class="border-t dark:border-gray-700 pt-4">
        <textarea [(ngModel)]="newComment" placeholder="Escribe un comentario..."
          class="w-full p-3 border dark:border-gray-600 rounded resize-none" rows="3"></textarea>
        <button (click)="addComment()" [disabled]="!newComment().trim()"
          class="mt-2 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:bg-gray-300 dark:disabled:bg-gray-600">
          Agregar Comentario
        </button>
      </div>
    </div>
  </div>
</div>
}